<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worldbuilding Pentagon Helper</title>
    <style>
        /* CSS Variables and Basic Setup */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

        :root {
            --bg-color: #0d0d1a;
            --node-bg: #1a1a2e;
            --node-border: #4a4a68;
            --text-color: #e0e0e0;
            --primary-glow: #00f6ff;
            --secondary-glow: #ffc700;
            --panel-bg: #1f1f33;
            --panel-border: #33334d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding: 20px;
            /* **FIX**: Removed background from body itself */
            position: relative; 
        }

        /* **FIX**: Create a dedicated background layer using a pseudo-element */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            z-index: -2; /* Place it at the very back */
        }

        li {
            margin: 4px 0;
            line-height: 1.4;
            color: #f9d378;
        }


        /* --- Particle Background --- */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            /* **FIX**: Set z-index to be above the background but below content */
            z-index: -1; 
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            /* **FIX**: Give particles a solid color to be visible */
            background: var(--primary-glow); 
            animation: animate-particles linear infinite;
        }

        @keyframes animate-particles {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-100vh); opacity: 0; }
        }

        /* --- Main Layout --- */
        #main-container {
            display: flex;
            gap: 40px;
            align-items: center;
            max-width: 1400px;
            width: 100%;
            /* **FIX**: Make sure main content is on top */
            z-index: 1; 
        }

        /* --- All other styles remain the same --- */
        #pentagon-container {
            position: relative; aspect-ratio: 1 / 1; flex-shrink: 0;
            width: 600px; max-width: 90vw; margin: auto;
        }
        #pentagon-svg {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; overflow: visible; pointer-events: none;
        }
        #pentagon-outline {
            fill: none; stroke: var(--node-border); stroke-width: 1.5px;
            opacity: 0.5; filter: drop-shadow(0 0 3px var(--node-border));
        }
        #connection-line {
            stroke: var(--primary-glow); stroke-width: 3px; stroke-linecap: round;
            filter: drop-shadow(0 0 5px var(--primary-glow)) drop-shadow(0 0 10px var(--primary-glow));
            opacity: 0; transition: opacity 0.4s ease, stroke 0.4s ease;
        }
        #connection-line.visible { opacity: 1; }
        #connection-line.second {
            stroke: var(--secondary-glow);
            filter: drop-shadow(0 0 5px var(--secondary-glow)) drop-shadow(0 0 10px var(--secondary-glow));
        }
        .node {
            position: absolute; width: 130px; height: 130px;
            background-color: var(--node-bg); border: 2px solid var(--node-border);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            text-align: center; font-size: 13px; font-weight: bold; line-height: 1.3;
            padding: 10px; cursor: pointer; user-select: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            box-shadow: 0 0 10px rgba(0,0,0,0.5); transform-origin: center center; 
        }
        .node:hover { transform: scale(1.1); border-color: var(--primary-glow); }
        .node.selected {
            border-color: var(--primary-glow);
            box-shadow: 0 0 15px 5px var(--primary-glow), inset 0 0 10px var(--primary-glow);
            animation: pulse 2s infinite;
        }
        .node.selected.second {
            border-color: var(--secondary-glow);
            box-shadow: 0 0 15px 5px var(--secondary-glow), inset 0 0 10px var(--secondary-glow);
            animation: pulse-second 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 15px 5px var(--primary-glow), inset 0 0 10px var(--primary-glow); }
            50% { box-shadow: 0 0 25px 8px var(--primary-glow), inset 0 0 15px var(--primary-glow); }
        }
        @keyframes pulse-second {
            0%, 100% { box-shadow: 0 0 15px 5px var(--secondary-glow), inset 0 0 10px var(--secondary-glow); }
            50% { box-shadow: 0 0 25px 8px var(--secondary-glow), inset 0 0 15px var(--secondary-glow); }
        }
        #content-panel {
            flex-grow: 1; background-color: var(--panel-bg); border: 1px solid var(--panel-border);
            border-radius: 12px; padding: 25px; height: 80vh; max-height: 700px;
            overflow-y: auto; opacity: 0; visibility: hidden;
            transform: translateX(30px) scale(0.95);
            transition: opacity 0.5s ease, transform 0.5s ease, visibility 0.5s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        #content-panel.visible { opacity: 1; visibility: visible; transform: translateX(0) scale(1); }
        #content-panel h2 {
            font-size: 24px; margin-bottom: 20px; padding-bottom: 10px;
            border-bottom: 2px solid var(--node-border); color: var(--primary-glow);
        }
        #content-panel .interaction-block { margin-bottom: 30px; }
        #content-panel h3 { font-size: 18px; color: var(--secondary-glow); margin-top: 20px; margin-bottom: 10px; }
        #content-panel p { font-size: 15px; line-height: 1.6; margin-bottom: 15px; font-weight: 300; }
        #content-panel strong { font-weight: 700; color: #fff; }
        #content-panel i { color: #ccc; }
        #content-panel hr {
            border: 0; height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), var(--node-border), rgba(0, 0, 0, 0));
            margin: 35px 0;
        }
        #content-panel::-webkit-scrollbar { width: 8px; }
        #content-panel::-webkit-scrollbar-track { background: var(--bg-color); border-radius: 10px; }
        #content-panel::-webkit-scrollbar-thumb { background: var(--node-border); border-radius: 10px; }
        #content-panel::-webkit-scrollbar-thumb:hover { background: var(--primary-glow); }
        @media (max-width: 1024px) {
            #main-container { flex-direction: column; gap: 20px; }
            #pentagon-container { width: 500px; margin-bottom: 20px; }
            #content-panel { width: 100%; max-width: 90vw; height: 50vh; transform: translateY(30px) scale(0.95); }
            #content-panel.visible { transform: translateY(0) scale(1); }
        }
        @media (max-width: 600px) {
             #pentagon-container { width: 100%; min-height: 350px; }
             .node { width: 100px; height: 100px; font-size: 10px; padding: 5px; }
             #content-panel h2 { font-size: 20px; }
             #content-panel h3 { font-size: 16px; }
             #content-panel p { font-size: 14px; }
        }
    </style>
</head>
<body>
    <div id="particle-container"></div>
    <div id="main-container">
        <!-- The rest of the HTML is identical and correct -->
        <div id="pentagon-container">
            <svg id="pentagon-svg">
                <polygon id="pentagon-outline" points="" />
                <line id="connection-line" x1="0" y1="0" x2="0" y2="0" />
            </svg>
            <div class="node" data-id="geography" data-name="ĐỊA LÝ & KHÍ HẬU">ĐỊA LÝ &<br>KHÍ HẬU</div>
            <div class="node" data-id="history" data-name="LỊCH SỬ & VĂN HÓA">LỊCH SỬ &<br>VĂN HÓA</div>
            <div class="node" data-id="politics" data-name="THỂ CHẾ CHÍNH TRỊ & XÃ HỘI">THỂ CHẾ CHÍNH TRỊ<br>& XÃ HỘI</div>
            <div class="node" data-id="economy" data-name="KINH TẾ & CÔNG NGHỆ">KINH TẾ &<br>CÔNG NGHỆ</div>
            <div class="node" data-id="supernatural" data-name="HỆ THỐNG SIÊU NHIÊN">HỆ THỐNG<br>SIÊU NHIÊN</div>
        </div>
        <div id="content-panel"><div id="content-display"></div></div>
    </div>
    
    <!-- JavaScript is identical and correct, no changes needed -->
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let worldbuildingData = {};
        const container = document.getElementById('pentagon-container');
        const nodes = document.querySelectorAll('.node');
        const line = document.getElementById('connection-line');
        const contentPanel = document.getElementById('content-panel');
        const contentDisplay = document.getElementById('content-display');
        const pentagonOutline = document.getElementById('pentagon-outline');
        const particleContainer = document.getElementById('particle-container');
        let selectedNodes = [];

        function createParticles() {
            const particleCount = 100;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = 20 + Math.random() * 30;
                const delay = Math.random() * 20;
                const size = 0.5 + Math.random() * 2; // Made particles slightly larger
                const opacity = 0.2 + Math.random() * 0.5;
                particle.style.left = `${x}vw`;
                particle.style.top = `${y}vh`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${-delay}s`;
                particle.style.opacity = opacity; // Set initial opacity
                particle.style.boxShadow = `0 0 6px ${getComputedStyle(document.documentElement).getPropertyValue('--primary-glow')}`;
                particleContainer.appendChild(particle);
            }
        }

        function positionNodes() {
            const numNodes = nodes.length;
            const width = container.clientWidth;
            const height = container.clientHeight;
            const radius = Math.min(width, height) * 0.4;
            const centerX = width / 2;
            const centerY = height / 2;
            let polygonPoints = [];
            nodes.forEach((node, i) => {
                const angle = (i / numNodes) * 2 * Math.PI - Math.PI / 2;
                const nodeX = centerX + radius * Math.cos(angle);
                const nodeY = centerY + radius * Math.sin(angle);
                polygonPoints.push(`${nodeX},${nodeY}`);
                node.style.left = `${nodeX - node.offsetWidth / 2}px`;
                node.style.top = `${nodeY - node.offsetHeight / 2}px`;
            });
            pentagonOutline.setAttribute('points', polygonPoints.join(' '));
            updateUI();
        }
        
        function getNodeCenter(node) {
            const rect = node.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            return {
                x: rect.left - containerRect.left + rect.width / 2,
                y: rect.top - containerRect.top + rect.height / 2
            };
        }

        function handleNodeClick(event) {
            const clickedNode = event.currentTarget;
            if (selectedNodes.includes(clickedNode)) return;
            selectedNodes.push(clickedNode);
            if (selectedNodes.length > 2) {
                selectedNodes.shift();
            }
            updateUI();
        }

        function updateUI() {
            nodes.forEach(node => {
                node.classList.remove('selected', 'second');
                if (selectedNodes.includes(node)) {
                    node.classList.add('selected');
                    if (selectedNodes.indexOf(node) === 1) {
                         node.classList.add('second');
                    }
                }
            });
            if (selectedNodes.length === 2) {
                const [node1, node2] = selectedNodes;
                const pos1 = getNodeCenter(node1);
                const pos2 = getNodeCenter(node2);
                line.setAttribute('x1', pos1.x);
                line.setAttribute('y1', pos1.y);
                line.setAttribute('x2', pos2.x);
                line.setAttribute('y2', pos2.y);
                line.classList.add('visible');
                line.classList.toggle('second', node2.classList.contains('second'));
            } else {
                line.classList.remove('visible');
            }
            let finalHTML = '';
            if (selectedNodes.length === 2) {
                const [node1, node2] = selectedNodes;
                const id1 = node1.dataset.id, name1 = node1.dataset.name;
                const id2 = node2.dataset.id, name2 = node2.dataset.name;
                const data1 = worldbuildingData[id1];
                const data2 = worldbuildingData[id2];
                const interaction1_on_2 = data1.impacts[id2] || `<p>Không có phân tích trực tiếp.</p>`;
                const interaction2_on_1 = data2.impacts[id1] || `<p>Không có phân tích trực tiếp.</p>`;
                finalHTML = `<h2>${name1} <span style="color: var(--text-color);">↔️</span> ${name2}</h2>
                    <div><h2>Tổng quan về ${name1}</h2>${data1.description}</div>
                    <div><h2>Tổng quan về ${name2}</h2>${data2.description}</div><hr>
                    <div class="interaction-block"><h2>${data1.title}</h2>${interaction1_on_2}</div>
                    <div class="interaction-block"><h2>${data2.title}</h2>${interaction2_on_1}</div>`;
            } else if (selectedNodes.length === 1) {
                const node = selectedNodes[0];
                const id = node.dataset.id, name = node.dataset.name;
                finalHTML = `<h2>${name}</h2><div>${worldbuildingData[id].description}</div>`;
            } else {
                finalHTML = `<h2>Chào mừng đến với Worldbuilding Helper</h2>
                    <p>Click vào <strong>một trụ cột</strong> để xem mô tả chi tiết.</p>
                    <p>Click vào <strong>trụ cột thứ hai</strong> để xem mô tả của cả hai và mối liên kết nguyên nhân - kết quả giữa chúng.</p>`;
            }
            contentDisplay.innerHTML = finalHTML;
            contentPanel.scrollTop = 0; 
            contentPanel.classList.add('visible');
        }

        async function initializeApp() {
            try {
                createParticles();
                const response = await fetch('data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                worldbuildingData = await response.json();
                nodes.forEach(node => node.addEventListener('click', handleNodeClick));
                positionNodes();
                updateUI();
                window.addEventListener('resize', positionNodes);
            } catch (error) {
                console.error("Không thể tải file data.json:", error);
                contentDisplay.innerHTML = `<h2>Lỗi!</h2><p>Không thể tải dữ liệu worldbuilding. Vui lòng kiểm tra lại file <strong>data.json</strong>.</p>`;
                contentPanel.classList.add('visible');
            }
        }

        initializeApp();
    });
    </script>
</body>
</html>